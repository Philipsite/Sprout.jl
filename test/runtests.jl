using Test
using sb21_surrogate

@testset "sb21_surrogate" begin

@testset "model.jl" begin
    y_clas = [1. 0. 1.;
              1. 0. 1.;
              1. 0. 0.;
              0. 0. 0.;
              0. 0. 0.;
              0. 0. 0.;
              0. 0. 0.;
              0. 0. 0.;
              0. 0. 0.;
              0. 0. 0.;
              0. 0. 0.;
              0. 0. 0.;
              0. 0. 0.;
              0. 0. 0.;
              0. 0. 0.;
              0. 0. 0.;
              0. 0. 0.;
              0. 0. 1.;
              0. 0. 0.;
              0. 0. 0.;
              1. 0. 0.;
              0. 1. 0.]

    y_reg = ones(112, 3)
    y = connection(y_clas, y_reg)
    @test y[1:22, 1] == [1.; 1.; 1.; 0.; 0.; 0.; 0.; 0.; 0.; 0.; 0.; 0.; 0.; 0.; 0.; 0.; 0.; 0.; 0.; 0.; 1.; 0.]
    @test y[1:22, 3] == [1.; 1.; 0.; 0.; 0.; 0.; 0.; 0.; 0.; 0.; 0.; 0.; 0.; 0.; 0.; 0.; 0.; 1.; 0.; 0.; 0.; 0.]
    @test y[23:end, 2] == vcat(repeat([0.], 6*14), ones(6))
    @test y[23:end, 3] == vcat(repeat([0.], 6*10), ones(6), repeat([0.], 6*4))
end

@testset "norm.jl" begin
    x = [0 2 1 0 0 0;
         0 0 0 0 0 0;
         6. 0 0 0 0 0]

    x_norm = Norm(x)
    @test x_norm.mean == [0.5; 0; 1;;]
    @test x_norm.std ≈ [0.83666002; 0.0; 2.449489742;;]

    x_n = x_norm(x)
    @test x_n ≈ [-0.5976143046671968 1.7928429140015905 0.5976143046671968 -0.5976143046671968 -0.5976143046671968 -0.5976143046671968; 0.0 0.0 0.0 0.0 0.0 0.0; 2.041241452319315 -0.4082482904638631 -0.4082482904638631 -0.4082482904638631 -0.4082482904638631 -0.4082482904638631]
end
@testset "phases_sb21" begin
    @test size(PP_COMP) == (length(PP) * 6, )
    @test size(SS_COMP) == (length(SS) * 6, )
end
end
