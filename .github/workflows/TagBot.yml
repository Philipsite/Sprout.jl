name: TagBot
on:
  push:
    branches: [main]
    paths: ['Project.toml']
permissions:
  contents: write
jobs:
  tag:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Get version and create tag
        run: |
          VERSION=$(grep '^version' Project.toml | sed 's/.*"\(.*\)"/\1/')
          echo "Detected version: $VERSION"
          if git rev-parse "v$VERSION" >/dev/null 2>&1; then
            echo "Tag v$VERSION already exists, skipping"
          else
            git config user.name "github-actions[bot]"
            git config user.email "github-actions[bot]@users.noreply.github.com"
            git tag "v$VERSION"
            git push origin "v$VERSION"
            echo "Created and pushed tag v$VERSION"
          fi
